<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Our Story - PlayThyng</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Pacifico&family=Montserrat:wght@400;500;600;700&family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              background: '#222',
              header: '#111',
              card: '#222',
              text: '#888',
              white: '#fff',
            },
            borderRadius: {
              none: "0px",
              sm: "4px",
              DEFAULT: "8px",
              md: "12px",
              lg: "16px",
              xl: "20px",
              "2xl": "24px",
              "3xl": "32px",
              full: "9999px",
              button: "8px",
            },
            boxShadow: {
              glass: '0 4px 32px 0 rgba(0,0,0,0.25)',
              card: '0 4px 24px 0 rgba(0,0,0,0.5)',
            },
          },
        },
      };
    </script>
    <style>
      body {
        font-family: 'Inter', sans-serif;
        background: #222;
        color: #888;
      }
      header, footer {
        background: #111 !important;
        color: #888 !important;
      }
      .story-card {
        background: #1A1B26;
        box-shadow: 0 4px 24px 0 rgba(0,0,0,0.5);
        border-radius: 16px;
        border: 1.5px solid #2E2F3A;
      }
      h1, h2, h3, h4, h5, h6 {
        color: #F5F5F5;
      }
      a, .nav-link {
        color: #888;
        transition: color 0.2s;
      }
      a:hover, .nav-link:hover {
        color: #fff;
      }
      .btn-primary {
        background: #4b5a5a;
        color: #fff;
        font-weight: 600;
        border-radius: 8px;
        transition: box-shadow 0.2s, background 0.2s, transform 0.2s;
        padding: 1rem 2rem;
        border: none;
        cursor: pointer;
        font-size: 1.125rem;
      }
      .btn-primary:hover {
        background: #3a4646;
        box-shadow: 0 0 0 4px rgba(75, 90, 90, 0.3), 0 4px 32px 0 rgba(75, 90, 90, 0.3);
        transform: translateY(-2px) scale(1.03);
      }
      .btn-primary:disabled {
        background: #666;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      .divider {
        border-color: #2E2F3A;
      }
      .fade-in {
        animation: fadeIn 0.8s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .popup-overlay {
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(4px);
      }
      .popup-content {
        background: #1A1B26;
        border: 1.5px solid #2E2F3A;
        box-shadow: 0 8px 48px 0 rgba(0,0,0,0.7);
      }
      .form-input {
        background: #222;
        border: 1.5px solid #2E2F3A;
        color: #F5F5F5;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      .form-input:focus {
        outline: none;
        border-color: #4b5a5a;
        box-shadow: 0 0 0 3px rgba(75, 90, 90, 0.2);
      }
      .form-input::placeholder {
        color: #888;
      }
      .form-input:invalid {
        border-color: #ef4444;
      }
      .close-btn {
        background: none;
        border: none;
        color: #888;
        font-size: 2rem;
        cursor: pointer;
        transition: color 0.2s;
      }
      .close-btn:hover {
        color: #fff;
      }
      .spinner {
        border: 2px solid #2E2F3A;
        border-top: 2px solid #4b5a5a;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
        display: inline-block;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 10000;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 300px;
        box-shadow: 0 4px 24px rgba(0,0,0,0.3);
        animation: slideIn 0.3s ease-out;
      }
      .notification.success {
        background: #10b981;
      }
      .notification.error {
        background: #ef4444;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      .debug-info {
        background: #1a1a1a;
        border: 1px solid #333;
        border-radius: 8px;
        padding: 16px;
        margin: 16px 0;
        color: #ccc;
        font-family: monospace;
        font-size: 12px;
      }
    </style>
  </head>
  <body class="bg-background text-text">
    <!-- Header -->
    <header class="fixed w-full top-0 z-50 bg-header backdrop-blur-sm border-b border-divider">
      <nav class="flex items-center justify-between h-28 px-8">
        <div class="flex items-center gap-8">
          <a href="anasayfa.html" class="text-2xl font-['Pacifico'] text-primary nav-link">
            <img src="assets/logo-large.png" alt="logo" class="h-36" />
          </a>
          <a href="anasayfa.html" class="nav-link text-xl" style="color:#4b5a5a;">Home</a>
          <a href="hakkımızda.html" class="nav-link text-xl" style="color:#4b5a5a;">About Us</a>
          <a href="oyunlar.html" class="nav-link text-xl" style="color:#4b5a5a;">Games</a>
        </div>
        <div class="flex items-center gap-6">
          <a href="https://store.epicgames.com/tr/p/trap-again-b4c656" target="_blank" rel="noopener" title="Epic Games" class="text-3xl">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
          </a>
          <a href="https://x.com/Playthyng" target="_blank" rel="noopener" title="X" class="text-3xl"><i class="ri-twitter-x-line"></i></a>
          <a href="https://www.youtube.com/@playthyng" target="_blank" rel="noopener" title="YouTube" class="text-3xl"><i class="ri-youtube-fill"></i></a>
          <a href="https://playthyng.itch.io/trap-again" target="_blank" rel="noopener" title="Itch.io" class="text-3xl"><i class="ri-gamepad-line"></i></a>
          <a href="https://www.reddit.com/user/Playthyng/" target="_blank" rel="noopener" title="Reddit" class="text-3xl"><i class="ri-reddit-fill"></i></a>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="pt-20">
      <section class="py-24 min-h-screen flex items-center">
        <div class="container mx-auto px-8">
          <div class="max-w-4xl mx-auto">
            <!-- Story Card -->
            <div class="story-card p-12 fade-in" style="background:#111;">
              <div class="text-center mb-12">
                <h1 class="text-5xl font-bold font-['Montserrat'] mb-6" style="color:#4b5a5a;">
                  Our Story
                </h1>
                <div class="w-24 h-1 bg-gradient-to-r from-transparent via-gray-600 to-transparent mx-auto"></div>
              </div>
              
              <div class="prose prose-lg max-w-none">
                <p class="text-lg leading-relaxed mb-6" style="color:#D1D5DB;">
                  Founded in 2025, PlayThyng is the realization of a dream that began in a small 5-square-meter room. We are a solo independent game studio driven by the passion of a university student who believes that imagination should be the main character in game development. Our journey started with a simple yet powerful goal: to prove that inspiring, creative, and genuinely fun experiences can be crafted without the need for massive budgets.
                </p>
                
                <p class="text-lg leading-relaxed mb-6" style="color:#D1D5DB;">
                  Currently navigating the challenges of academic life, our founder pours every spare moment into this venture. The development of our first title, 'Trap Again,' is a testament to this dedication—a project brought to life between lectures, study sessions, and late-night coding sprints. This process has reinforced our core belief that technology is simply a canvas for creativity.
                </p>
                
                <p class="text-lg leading-relaxed mb-6" style="color:#D1D5DB;">
                  At PlayThyng, we thrive on creating experimental games that blend imaginative concepts with engaging technology. We don't just want to make games; we want to build worlds that spark curiosity and challenge players in unexpected ways. Our philosophy is that a game's true value lies in its ability to offer a unique and memorable adventure.
                </p>
                
                <p class="text-lg leading-relaxed mb-12" style="color:#D1D5DB;">
                  We are incredibly proud of the path we've taken and deeply grateful to everyone who has joined us on this journey. If our story and our work resonate with you, we would love to hear from you. Get in touch to learn more about our creative process and what's next for PlayThyng.
                </p>
              </div>
              
              <!-- Contact Us Button -->
              <div class="text-center">
                <button id="contact-btn" class="btn-primary inline-flex items-center gap-3">
                  <i class="ri-mail-line text-xl"></i>
                  Contact Us
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-header text-text py-16">
      <div class="container mx-auto px-8">
        <div class="grid grid-cols-4 gap-8">
          <div>
            <a href="anasayfa.html" class="text-2xl font-['Pacifico'] text-primary mb-6 block">
              <img src="assets/logo-large.png" alt="logo" class="h-24" />
            </a>
            <p class="text-gray-400">
              Leading game studio offering innovative gaming experiences.
            </p>
          </div>
          <div>
            <h3 class="font-semibold mb-4">Company</h3>
            <ul class="space-y-2">
              <li>
                <a href="hakkımızda.html" class="text-gray-400 hover:text-white transition-colors">About Us</a>
              </li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold mb-4">Games</h3>
            <ul class="space-y-2">
              <li>
                <a href="oyunlar.html" class="text-gray-400 hover:text-white transition-colors">All Games</a>
              </li>
            </ul>
          </div>
          <div>
            <h3 class="font-semibold mb-4">Social Media</h3>
            <div class="flex gap-4">
              <a href="https://store.epicgames.com/tr/p/trap-again-b4c656" target="_blank" rel="noopener" title="Epic Games" class="text-2xl">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
              </a>
              <a href="https://x.com/Playthyng" target="_blank" rel="noopener" title="X" class="text-2xl"><i class="ri-twitter-x-line"></i></a>
              <a href="https://www.youtube.com/@playthyng" target="_blank" rel="noopener" title="YouTube" class="text-2xl"><i class="ri-youtube-fill"></i></a>
              <a href="https://playthyng.itch.io/trap-again" target="_blank" rel="noopener" title="Itch.io" class="text-2xl"><i class="ri-gamepad-line"></i></a>
              <a href="https://www.reddit.com/user/Playthyng/" target="_blank" rel="noopener" title="Reddit" class="text-2xl"><i class="ri-reddit-fill"></i></a>
            </div>
          </div>
        </div>
        <div class="border-t border-gray-800 mt-12 pt-8 flex justify-between items-center">
          <p class="text-gray-400">© 2025 All rights reserved.</p>
          <div class="flex gap-6">
            <a href="#" id="privacy-link" class="text-gray-400 hover:text-white transition-colors">Privacy Policy</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Privacy Policy Popup -->
    <div id="privacy-popup" style="display:none; position:fixed; z-index:9999; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.7);">
      <div style="background:#222; color:#fff; max-width:90vw; width:100%; max-height:90vh; margin:5vh auto; border-radius:16px; box-shadow:0 4px 32px 0 rgba(0,0,0,0.5); padding:2rem; position:relative; overflow-y:auto;">
        <button id="privacy-close" style="position:absolute; top:1rem; right:1rem; background:none; border:none; color:#fff; font-size:2rem; cursor:pointer;">&times;</button>
        <h2 style="color:#4b5a5a; font-size:1.5rem; font-weight:bold; margin-bottom:1rem;">Trap Again Privacy Policy</h2>
        <div style="color:#D1D5DB; font-size:1rem; white-space:pre-line;">
Trap Again Privacy Policy
Last updated: July 20, 2025

This Privacy Policy explains how we collect, use, share, and store your personal data when you use our application, Trap Again.

Who We Are
We are PlayThyng, an independent game studio founded in 2025. You can contact us at playthyng@gmail.com.

Data We Collect
Epic Games Account ID
In-game progress and settings
IP address, browser type, device information

How We Use Your Data
Authentication
Storing game data
Performance analysis
Responding to user feedback

Data Sharing
Data is only shared with Epic Games and anonymous analytics tools. It is never shared with third parties without your explicit consent.

Data Retention
Inactive user data is deleted after 12 months. Anonymous data may be retained indefinitely for analytical purposes.

Your Rights
Access and correction of your data
Request for deletion
Objection to processing

Children's Privacy
Trap Again is PEGI 3 certified and suitable for children.

Contact
playthyng@gmail.com
        </div>
      </div>
    </div>

    <!-- Contact Popup -->
    <div id="contact-popup" class="fixed inset-0 z-50 popup-overlay hidden flex items-center justify-center p-4">
      <div class="popup-content max-w-md w-full rounded-2xl p-8 relative" style="background:#111;">
        <button id="close-popup" class="close-btn absolute top-4 right-4">
          <i class="ri-close-line"></i>
        </button>
        
        <div class="text-center mb-8">
          <h2 class="text-2xl font-bold font-['Montserrat'] mb-2" style="color:#4b5a5a;">
            Get In Touch
          </h2>
          <p class="text-gray-400">
            We'd love to hear from you. Send us a message and we'll respond as soon as possible.
          </p>
        </div>

        <!-- Debug Panel -->
        <div id="debug-panel" class="debug-info mb-4" style="display:none;">
          <div><strong>EmailJS Status:</strong> <span id="emailjs-status">Initializing...</span></div>
          <div><strong>Service ID:</strong> <span id="debug-service"></span></div>
          <div><strong>Template ID:</strong> <span id="debug-template"></span></div>
          <div><strong>Public Key:</strong> <span id="debug-publickey"></span></div>
          <div><strong>Last Error:</strong> <span id="debug-error">None</span></div>
        </div>

        <form id="contact-form" class="space-y-6" novalidate>
          <div>
            <label class="block text-sm font-medium mb-2" style="color:#D1D5DB;">Name *</label>
            <input 
              type="text" 
              name="from_name" 
              required 
              class="form-input w-full" 
              placeholder="Your name"
              minlength="2"
              maxlength="50"
            >
            <div class="error-message text-red-400 text-sm mt-1 hidden"></div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-2" style="color:#D1D5DB;">Email *</label>
            <input 
              type="email" 
              name="reply_to" 
              required 
              class="form-input w-full" 
              placeholder="your@email.com"
              maxlength="100"
            >
            <div class="error-message text-red-400 text-sm mt-1 hidden"></div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-2" style="color:#D1D5DB;">Message *</label>
            <textarea 
              name="message" 
              required 
              class="form-input w-full h-32 resize-none" 
              placeholder="Tell us about your thoughts, ideas, or questions..."
              minlength="10"
              maxlength="1000"
            ></textarea>
            <div class="error-message text-red-400 text-sm mt-1 hidden"></div>
            <div class="text-gray-500 text-xs mt-1">
              <span id="char-count">0</span>/1000 characters
            </div>
          </div>
          
          <button type="submit" id="submit-btn" class="btn-primary w-full">
            <span id="btn-text" class="flex items-center justify-center gap-2">
              <i class="ri-send-plane-line"></i>
              Send Message
            </span>
            <span id="btn-loading" class="hidden flex items-center justify-center gap-2">
              <div class="spinner"></div>
              Sending...
            </span>
          </button>
        </form>

        <div class="mt-6 pt-6 border-t border-gray-700 text-center">
          <p class="text-gray-400 text-sm mb-2">Or reach us directly at:</p>
          <a href="mailto:playthyng@gmail.com" class="text-white hover:underline">
            playthyng@gmail.com
          </a>
        </div>
      </div>
    </div>

    <!-- Responsive CSS -->
    <style>
      html { box-sizing: border-box; }
      *, *:before, *:after { box-sizing: inherit; }
      body { margin: 0; padding: 0; }
      @media (max-width: 640px) {
        .container { padding-left: 1rem !important; padding-right: 1rem !important; }
        #privacy-popup > div {
          padding: 1rem !important;
          max-width: 98vw !important;
          max-height: 98vh !important;
        }
        #privacy-popup h2 { font-size: 1.1rem !important; }
        #privacy-popup div[style*='white-space:pre-line'] { font-size: 0.95rem !important; }
        .notification {
          right: 10px;
          left: 10px;
          min-width: auto;
        }
      }
    </style>

    <!-- JavaScript -->
    <script>
      // EmailJS Configuration - Kendi bilgilerinizle güncelleyin
      const EMAILJS_CONFIG = {
        publicKey: 'ZzrpzoPvfyGwb6dSs', // EmailJS Public Key
        serviceId: 'service_fo2ss31',    // EmailJS Service ID
        templateId: 'template_l7umfoj'   // EmailJS Template ID
      };

      // EmailJS'i aktif hale getirin
      const USE_EMAILJS = true;

      // Rate limiting - kullanıcı başına mesaj sayısını sınırla
      const rateLimiter = {
        attempts: new Map(),
        maxAttempts: 3,
        windowMs: 60000, // 1 dakika
        
        canSend() {
          const now = Date.now();
          const userKey = 'user'; // Gerçek uygulamada IP veya user ID kullanın
          const userAttempts = this.attempts.get(userKey) || [];
          
          // Eski kayıtları temizle
          const validAttempts = userAttempts.filter(time => now - time < this.windowMs);
          
          if (validAttempts.length >= this.maxAttempts) {
            return false;
          }
          
          validAttempts.push(now);
          this.attempts.set(userKey, validAttempts);
          return true;
        }
      };

      // Notification system
      function showNotification(message, type = 'success') {
        const existingNotifications = document.querySelectorAll('.notification');
        existingNotifications.forEach(notification => notification.remove());

        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        
        const icon = type === 'success' ? 'ri-check-line' : 'ri-error-warning-line';
        notification.innerHTML = `
          <i class="${icon}"></i>
          <span>${message}</span>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          if (notification.parentNode) {
            notification.remove();
          }
        }, 5000);
      }

      // Güvenli input sanitization
      function sanitizeInput(input) {
        if (!input) return '';
        return input
          .trim()
          .replace(/[<>'"&]/g, function(match) {
            const entities = {
              '<': '&lt;',
              '>': '&gt;',
              '"': '&quot;',
              "'": '&#x27;',
              '&': '&amp;'
            };
            return entities[match];
          });
      }

      // Gelişmiş email validation
      function validateEmail(email) {
        const re = /^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;
        return re.test(email) && email.length <= 254;
      }

      // Form validation
      function validateForm(formData) {
        const errors = {};

        // Name validation
        const name = formData.get('from_name')?.trim() || '';
        if (!name) {
          errors.from_name = 'Name is required';
        } else if (name.length < 2) {
          errors.from_name = 'Name must be at least 2 characters';
        } else if (name.length > 50) {
          errors.from_name = 'Name must be less than 50 characters';
        } else if (!/^[a-zA-ZÀ-ÿ\s'-]+$/.test(name)) {
          errors.from_name = 'Name can only contain letters, spaces, hyphens and apostrophes';
        }

        // Email validation
        const email = formData.get('reply_to')?.trim() || '';
        if (!email) {
          errors.reply_to = 'Email is required';
        } else if (!validateEmail(email)) {
          errors.reply_to = 'Please enter a valid email address';
        }

        // Message validation
        const message = formData.get('message')?.trim() || '';
        if (!message) {
          errors.message = 'Message is required';
        } else if (message.length < 10) {
          errors.message = 'Message must be at least 10 characters';
        } else if (message.length > 1000) {
          errors.message = 'Message must be less than 1000 characters';
        }

        return errors;
      }

      // Display form errors
      function displayErrors(errors) {
        document.querySelectorAll('.error-message').forEach(el => {
          el.textContent = '';
          el.classList.add('hidden');
        });
        document.querySelectorAll('.form-input').forEach(el => {
          el.classList.remove('border-red-500');
        });

        Object.keys(errors).forEach(field => {
          const input = document.querySelector(`[name="${field}"]`);
          const errorDiv = input?.parentNode?.querySelector('.error-message');
          
          if (input && errorDiv) {
            input.classList.add('border-red-500');
            errorDiv.textContent = errors[field];
            errorDiv.classList.remove('hidden');
          }
        });
      }

      // Debug panel update
      function updateDebugPanel(status, error = null) {
        const statusEl = document.getElementById('emailjs-status');
        const errorEl = document.getElementById('debug-error');
        const serviceEl = document.getElementById('debug-service');
        const templateEl = document.getElementById('debug-template');
        const publickeyEl = document.getElementById('debug-publickey');
        
        if (statusEl) {
          statusEl.textContent = status;
          statusEl.style.color = error ? '#ef4444' : '#10b981';
        }
        
        if (errorEl) {
          errorEl.textContent = error || 'None';
          errorEl.style.color = error ? '#ef4444' : '#888';
        }
        
        if (serviceEl) serviceEl.textContent = EMAILJS_CONFIG.serviceId;
        if (templateEl) templateEl.textContent = EMAILJS_CONFIG.templateId;
        if (publickeyEl) publickeyEl.textContent = EMAILJS_CONFIG.publicKey;
      }

      // Initialize EmailJS
      function initEmailJS() {
        if (!USE_EMAILJS) {
          updateDebugPanel('Disabled (USE_EMAILJS = false)');
          return Promise.resolve(false);
        }
        
        return new Promise((resolve) => {
          try {
            // EmailJS'in yüklenip yüklenmediğini kontrol et
            if (typeof emailjs === 'undefined') {
              throw new Error('EmailJS library not loaded');
            }

            // EmailJS'i başlat
            emailjs.init({
              publicKey: EMAILJS_CONFIG.publicKey,
              blockHeadless: false, // Headless browser hatası için
              limitRate: {
                throttle: 10000, // 10 saniye throttle
              }
            });

            updateDebugPanel('Initialized successfully');
            console.log('EmailJS initialized successfully');
            resolve(true);

          } catch (error) {
            console.error('EmailJS initialization failed:', error);
            updateDebugPanel('Failed to initialize', error.message);
            resolve(false);
          }
        });
      }

      // Send email using EmailJS
      async function sendEmailViaEmailJS(templateParams) {
        if (!USE_EMAILJS || typeof emailjs === 'undefined') {
          throw new Error('EmailJS not available');
        }

        try {
          console.log('Sending email with params:', templateParams);
          
          const response = await emailjs.send(
            EMAILJS_CONFIG.serviceId,
            EMAILJS_CONFIG.templateId,
            templateParams,
            EMAILJS_CONFIG.publicKey
          );
          
          console.log('EmailJS response:', response);
          updateDebugPanel('Email sent successfully');
          return response;

        } catch (error) {
          console.error('EmailJS send error:', error);
          const errorMsg = error.text || error.message || 'Unknown error';
          updateDebugPanel('Send failed', errorMsg);
          throw error;
        }
      }

      // Fallback email method (opens default mail client)
      function sendEmailFallback(formData) {
        const name = formData.get('from_name');
        const email = formData.get('reply_to');
        const message = formData.get('message');
        
        const subject = encodeURIComponent(`Contact Form Message from ${name}`);
        const body = encodeURIComponent(`Name: ${name}\nEmail: ${email}\n\nMessage:\n${message}`);
        const mailtoLink = `mailto:playthyng@gmail.com?subject=${subject}&body=${body}`;
        
        window.open(mailtoLink);
        return Promise.resolve({ status: 200 });
      }

      document.addEventListener('DOMContentLoaded', async function() {
        console.log('DOM loaded, initializing...');
        
        // Initialize EmailJS
        const emailjsReady = await initEmailJS();

        // DOM elements
        const contactBtn = document.getElementById('contact-btn');
        const contactPopup = document.getElementById('contact-popup');
        const closePopup = document.getElementById('close-popup');
        const contactForm = document.getElementById('contact-form');
        const submitBtn = document.getElementById('submit-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoading = document.getElementById('btn-loading');
        const charCount = document.getElementById('char-count');
        const messageTextarea = document.querySelector('[name="message"]');

        // Privacy popup elements
        const privacyLink = document.getElementById('privacy-link');
        const privacyPopup = document.getElementById('privacy-popup');
        const privacyClose = document.getElementById('privacy-close');

        console.log('Contact button found:', !!contactBtn);
        console.log('Contact popup found:', !!contactPopup);
        console.log('EmailJS ready:', emailjsReady);

        // Debug panel toggle (Shift + D)
        document.addEventListener('keydown', function(e) {
          if (e.shiftKey && e.key === 'D') {
            const debugPanel = document.getElementById('debug-panel');
            if (debugPanel) {
              debugPanel.style.display = debugPanel.style.display === 'none' ? 'block' : 'none';
            }
          }
        });

        // Character counter for message textarea
        if (messageTextarea && charCount) {
          messageTextarea.addEventListener('input', function() {
            const count = this.value.length;
            charCount.textContent = count;
            
            if (count > 1000) {
              charCount.style.color = '#ef4444';
            } else if (count > 800) {
              charCount.style.color = '#f59e0b';
            } else {
              charCount.style.color = '#6b7280';
            }
          });
        }

        // Open contact popup
        if (contactBtn && contactPopup) {
          contactBtn.addEventListener('click', function(e) {
            console.log('Contact button clicked');
            e.preventDefault();
            contactPopup.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Focus on first input
            setTimeout(() => {
              const firstInput = contactForm?.querySelector('input[name="from_name"]');
              if (firstInput) firstInput.focus();
            }, 100);
          });
        }

        // Close contact popup
        function closeContactPopup() {
          console.log('Closing contact popup');
          if (contactPopup) {
            contactPopup.classList.add('hidden');
            document.body.style.overflow = 'auto';
            
            // Reset form state
            if (contactForm) {
              contactForm.reset();
              displayErrors({});
              if (charCount) charCount.textContent = '0';
              if (submitBtn) {
                submitBtn.disabled = false;
                if (btnText) btnText.classList.remove('hidden');
                if (btnLoading) btnLoading.classList.add('hidden');
              }
            }
          }
        }

        // Close popup handlers
        if (closePopup) {
          closePopup.addEventListener('click', closeContactPopup);
        }

        // Close contact popup when clicking outside
        if (contactPopup) {
          contactPopup.addEventListener('click', function(e) {
            if (e.target === contactPopup) {
              closeContactPopup();
            }
          });
        }

        // Handle contact form submission
        if (contactForm) {
          contactForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Rate limiting kontrolü
            if (!rateLimiter.canSend()) {
              showNotification('Too many messages sent. Please wait a minute before sending another message.', 'error');
              return;
            }
            
            const formData = new FormData(contactForm);
            
            // Validate form
            const errors = validateForm(formData);
            if (Object.keys(errors).length > 0) {
              displayErrors(errors);
              return;
            }

            // Clear any previous errors
            displayErrors({});

            // Show loading state
            if (submitBtn) {
              submitBtn.disabled = true;
              if (btnText) btnText.classList.add('hidden');
              if (btnLoading) btnLoading.classList.remove('hidden');
            }

            try {
              if (USE_EMAILJS && emailjsReady) {
                // Prepare template parameters with sanitized data
                const templateParams = {
                  from_name: sanitizeInput(formData.get('from_name').trim()),
                  reply_to: sanitizeInput(formData.get('reply_to').trim()),
                  message: sanitizeInput(formData.get('message').trim()),
                  to_email: 'playthyng@gmail.com',
                  timestamp: new Date().toLocaleString('tr-TR', {
                    timeZone: 'Europe/Istanbul',
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                  })
                };

                console.log('Attempting to send via EmailJS...');
                
                // Send email via EmailJS
                const response = await sendEmailViaEmailJS(templateParams);
                
                if (response.status === 200) {
                  showNotification('Message sent successfully! We\'ll get back to you soon.', 'success');
                  closeContactPopup();
                }
              } else {
                console.log('EmailJS not available, using fallback...');
                // Use fallback method (opens mail client)
                await sendEmailFallback(formData);
                showNotification('Opening your email client... Please send the pre-filled message.', 'success');
                closeContactPopup();
              }

            } catch (error) {
              console.error('Email Error:', error);
              
              let errorMessage = 'Failed to send message. Please try again or contact us directly at playthyng@gmail.com';
              
              // Handle specific EmailJS error types
              if (error.text || error.message) {
                const errorText = error.text || error.message;
                if (errorText.includes('rate limit') || errorText.includes('too many requests')) {
                  errorMessage = 'Rate limit exceeded. Please wait a moment before sending another message.';
                } else if (errorText.includes('invalid') || errorText.includes('not found')) {
                  errorMessage = 'Email service configuration error. Please contact us directly at playthyng@gmail.com';
                } else if (errorText.includes('network') || errorText.includes('timeout')) {
                  errorMessage = 'Network error. Please check your connection and try again.';
                }
              }
              
              showNotification(errorMessage, 'error');
              
              // Try fallback method if EmailJS fails
              if (USE_EMAILJS && emailjsReady) {
                console.log('EmailJS failed, trying fallback...');
                try {
                  await sendEmailFallback(formData);
                  showNotification('Opened your email client as backup. Please send the pre-filled message.', 'success');
                  closeContactPopup();
                } catch (fallbackError) {
                  console.error('Fallback also failed:', fallbackError);
                }
              }
            } finally {
              // Reset button state
              if (submitBtn) {
                submitBtn.disabled = false;
                if (btnText) btnText.classList.remove('hidden');
                if (btnLoading) btnLoading.classList.add('hidden');
              }
            }
          });
        }

        // Privacy popup functionality
        if (privacyLink && privacyPopup && privacyClose) {
          privacyLink.addEventListener('click', function(e) {
            e.preventDefault();
            privacyPopup.style.display = 'block';
            document.body.style.overflow = 'hidden';
          });
          
          privacyClose.addEventListener('click', function() {
            privacyPopup.style.display = 'none';
            document.body.style.overflow = 'auto';
          });
          
          privacyPopup.addEventListener('click', function(e) {
            if (e.target === privacyPopup) {
              privacyPopup.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          });
        }

        // Close popups with Escape key
        document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            if (contactPopup && !contactPopup.classList.contains('hidden')) {
              closeContactPopup();
            }
            if (privacyPopup && privacyPopup.style.display === 'block') {
              privacyPopup.style.display = 'none';
              document.body.style.overflow = 'auto';
            }
          }
        });

        // Real-time input validation
        if (contactForm) {
          const inputs = contactForm.querySelectorAll('input, textarea');
          inputs.forEach(input => {
            // Remove error styling when user starts typing
            input.addEventListener('input', function() {
              this.classList.remove('border-red-500');
              const errorDiv = this.parentNode.querySelector('.error-message');
              if (errorDiv && !errorDiv.classList.contains('hidden')) {
                errorDiv.textContent = '';
                errorDiv.classList.add('hidden');
              }
            });

            // Validate on blur
            input.addEventListener('blur', function() {
              const formData = new FormData(contactForm);
              const errors = validateForm(formData);
              
              // Only show error for the current field
              if (errors[this.name]) {
                const fieldError = {};
                fieldError[this.name] = errors[this.name];
                displayErrors(fieldError);
              }
            });
          });
        }

        // Prevent form submission on Enter key (except for textarea)
        if (contactForm) {
          contactForm.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA') {
              e.preventDefault();
            }
          });
        }

        // Honeypot için gizli alan ekle (bot koruması)
        if (contactForm) {
          const honeypot = document.createElement('input');
          honeypot.type = 'text';
          honeypot.name = 'website';
          honeypot.style.display = 'none';
          honeypot.tabIndex = -1;
          honeypot.autocomplete = 'off';
          contactForm.appendChild(honeypot);
          
          // Form submit sırasında honeypot kontrolü
          contactForm.addEventListener('submit', function(e) {
            if (honeypot.value) {
              e.preventDefault();
              console.log('Bot detected - honeypot filled');
              return false;
            }
          });
        }

        console.log('Contact form initialized successfully');
      });
    </script>

  </body>
</html>